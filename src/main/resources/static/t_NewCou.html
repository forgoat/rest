<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>新建课程</title>
    <meta content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=0" name="viewport"/>
    <meta content="yes" name="apple-mobile-web-app-capable"/>
    <meta content="black" name="apple-mobile-web-app-status-bar-style"/>
    <meta content="telephone=no" name="format-detection"/>
    <link href="css/custom.css" rel="stylesheet" type="text/css"/>
    <link rel="stylesheet" href="css/chosen.css">
    <script type="text/javascript" src="js/jquery.min.js"></script>

</head>
<body>
<section class="aui-flexView">
    <header class="aui-navBar aui-navBar-fixed b-line">
        <a href="javascript:history.back(-1);" class="aui-navBar-item">
            <i class="icon icon-return"></i>
        </a>
        <div class="aui-center">
            <span class="aui-center-title">新建课程</span>
        </div>

    </header>
    <section class="aui-scrollView">
        <div class="aui-code-box">



                <div class="col-md-12">
                    <p class="aui-code-line">
                        <input  class="aui-code-line-input"  type="text" placeholder="课程名称" name="userid" id="name"/>
                    </p>

                    <p class="aui-code-line">
                        <input  class="aui-code-line-input"  type="text" placeholder="课程要求" name="userid" id="require"/>
                    </p>
                    <br>
                    <div class="form-group" id="div1">
                        <label class="col-sm-2 control-label">成绩计算规则：</label>
                        <br>
                        <label class="col-sm-2 control-label">课堂展示：</label>

                        <input type="text" class="form-control" placeholder="50" id="score1">

                        <br>
                        <label class="col-sm-2 control-label">课堂提问：</label>

                        <input type="text" class="form-control" placeholder="20" id="score2">
                        <br>
                        <label class="col-sm-2 control-label">书面报告：</label>

                        <input type="text" class="form-control" placeholder="30" id="score3">
                    </div>
                    <hr>
                    <br>
                    <div class="form-group">
                        <label class="col-sm-2 control-label">小组人数：</label>

                        <br>
                        <input type="text" class="form-control" placeholder="上限" id="member1">
                        <input type="text" class="form-control" placeholder="下限" id="member2">
                        <br>
                        <br>
                        <div id="addstudentlimit">
                            <label class="col-sm-2 control-label">组内选修课程人数：</label>
                            <br>
                            <div >
                            <select name="dept" data-placeholder="选修课程" style="width:200px;height:25px" id="studentlimit0" class="limit_select">
                                <option value="0">课程名称+老师</option>
                                <option value="1">课程名称+老师</option>
                                <option value="2">课程名称+老师</option>
                            </select>
                            <br>
                            <br>
                            <input type="text" class="form-control" placeholder="上限" id="limit00">
                            <input type="text" class="form-control" placeholder="下限" id="limit10">
                        </div>
                        </div>
                        <br>
                        <div>
                            <select name="dept" data-placeholder="选课人数要求" style="width:200px;height:25px;display:none;" id="diss" class="dept_select">

                                <option value="0">均满足</option>
                                <option value="1">满足其一</option>

                            </select>
                        </div>
                        <div class="aui-code-box">
                            <button onclick="add1()">
                                新增
                            </button>
                        </div>
                    </div>


                    <hr>
                    <div id="chongtu">
                    <div>
                        <label class="col-sm-2 control-label">冲突课程：</label>
                        <select name="dept" data-placeholder="冲突课程" style="width:200px;height:25px" id="course0" class="limit_select">

                            <option value="0">课程名称+老师</option>
                            <option value="1">课程名称+老师</option>
                            <option value="2">课程名称+老师</option>

                        </select>
                    </div>
                    <div>
                        <label class="col-sm-2 control-label">冲突课程：</label>
                        <select name="dept" data-placeholder="冲突课程" style="width:200px;height:25px" id="course1" class="dept_select">
                        </select>
                    </div>
                    </div>
                    <div class="aui-code-box">
                        <button onclick="add2()" >
                            新增
                        </button>
                    </div>

                    <hr>

                    <label class="col-sm-2 control-label">组队要求：</label>
                    <br>

                    <label class="col-sm-2 control-label">组队开始时间：</label>

                    <input type="date" class="form-control" placeholder="年月日" id="start"/><br>
                    <label class="col-sm-2 control-label">组队截止时间：</label>

                    <input type="date" class="form-control" placeholder="年月日" id="end"/>


                </div>
                <div class="aui-code-box">
                    <button onclick="create()">
                        发布
                    </button>
                </div>

        </div>
    </section>
</section>
<script>
    var num=2;
    var numb1=1;
    var ischongtu=0;
    var islimit=0;
    $("select.dept_select").click(function () {
        ischongtu=1;
    });
    $("select.limit_select").click(function () {
        islimit=1;
    });
    function add1() {
        $("#diss").css("display","inline");
        var tmp = document.createElement('div');
        tmp.innerHTML = '<div >\n' +
            '                            <br>\n' +
            '                            <br>\n' +
            '                            <select name="dept" data-placeholder="选修课程" style="width:200px;height:25px" id="studentlimit'+numb1+'" class="dept_select">\n' +
            '                            </select>\n' +
            '                            <br>\n' +
            '                            <br>\n' +
            '                            <input type="text" class="form-control" placeholder="上限" id="limit0'+numb1+'">\n' +
            '                            <input type="text" class="form-control" placeholder="下限" id="limit1'+numb1+'">\n' +
            '                        </div>'//补全你的内容
        document.getElementById('addstudentlimit').appendChild(tmp);
        loadstudentlimit("studentlimit"+numb1);
        numb1++;

    }
    function add2() {
            var tmp = document.createElement('div');
            tmp.innerHTML = '<div>\n' +
                '                        <label class="col-sm-2 control-label">冲突课程：</label>\n' +
                '                        <select name="dept" data-placeholder="冲突课程" style="width:200px;height:25px" id="course'+num+'" class="dept_select">\n' +
                '                        </select>\n' +
                '                    </div>'//补全你的内容
            document.getElementById('chongtu').appendChild(tmp);
            loadstudentlimit("course"+num);
            num++;
    }
    var myModel = {courseList:[]};
    var youModel={teacherList:[]};
    var courseid=0;
    function loadpage() {
        for(var i=0;i<numb1;i++)
            loadstudentlimit("studentlimit"+i);
        for(var i=0;i<num;i++)
            loadstudentlimit("course"+i);
    }
    loadpage();
    function loadstudentlimit(urlid){
        var ht='';
        $('#'+urlid).empty();
         $.ajax({
            url:"/course",
            type: "GET",
            dataType:'json',
            success:function(em) {
                youModel.teacherList=em;
                if( youModel.teacherList.length>0)
                {
                    for(var i=0;i< youModel.teacherList.length;i++)
                    {
                        ht+='<option value="'+youModel.teacherList[i].id+'">';
                        ht+=youModel.teacherList[i].courseName;
                        ht+='</option>';
                    }
                    courseid=youModel.teacherList[youModel.teacherList.length-1].id+1;
                }
                $("#"+urlid).html(ht);

            },
            error: function(){
                alert('服务器忙，请稍候');
            }
        });
        }
    function create() {
        var teacherid=sessionStorage.getItem("id");
        var name=$("#name").val();
        var require=$("#require").val();
        var score1=$("#score1").val();
        var score2=$("#score2").val();
        var score3=$("#score3").val();
        var member1=$("#member1").val();
        var member2=$("#member2").val();
        var start=$("#start").val();
        var end=$("#end").val();
        var diss=-1;
        var course=[];
        var courseIdList_CourseMemberLimitStrategy=new Array();
        var minMemberList_CourseMemberLimitStrategy=new Array();
        var maxMemberList_CourseMemberLimitStrategy=new Array();
            for(var i=0;i<num;i++)
            {
                course.push($("#course"+i).val());
            }
            for(var i=0;i<numb1;i++)
            {
                courseIdList_CourseMemberLimitStrategy.push($("#studentlimit"+i).val());
                maxMemberList_CourseMemberLimitStrategy.push($("#limit0"+i).val());
                minMemberList_CourseMemberLimitStrategy.push($("#limit1"+i).val());
            }
            if(course.length>1&&course[0]==course[1])
            {
                    alert("不能重复限制");
            }else if(courseIdList_CourseMemberLimitStrategy.length>0&&courseIdList_CourseMemberLimitStrategy[0]==courseIdList_CourseMemberLimitStrategy[1])
                alert("不能重复限制");
            else{

                if(numb1>1)
                    diss=$("#diss").val();
                $.ajax({
                    url:"/course",
                    type: "POST",
                    dataType:'json',
                    data:{teacherId:teacherid,courseName:name,introduction:require,presentationPercentage:score1,questionPercentage:score2,reportPercentage:score3,teamStartTime:start,teamEndTime:end},
                    success:function(em) {
                        courseid=em;
                    },error:function () {
                        alert("create course failed");
                    }
                });
                $.ajax({
                    url:"/course/setTeamStrategy",
                    type: "POST",
                    dataType:'json',
                    data:{minMember_MemberLimitStrategy:member2,maxMember_MemberLimitStrategy:member1,option_CourseMemberLimitStrategy:diss,courseIdList_CourseMemberLimitStrategy:courseIdList_CourseMemberLimitStrategy[0],minMemberList_CourseMemberLimitStrategy:minMemberList_CourseMemberLimitStrategy[0],maxMemberList_CourseMemberLimitStrategy:maxMemberList_CourseMemberLimitStrategy[0],courseIdList_ConflictCourseStrategy:course[0],courseId_TeamStrategy:courseid},
                    success:function(em) {
                        alert("success");
                        window.location.href="t_CouMana.html";
                    },error:function () {
                        alert("set course failed");
                    }
                });
            }
            }

</script>
</body>
</html>

